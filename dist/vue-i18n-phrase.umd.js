!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a(require("chalk"),require("fs"),require("path"),require("vue-i18n-extract"),require("axios"),require("form-data")):"function"==typeof define&&define.amd?define(["chalk","fs","path","vue-i18n-extract","axios","form-data"],a):(e=e||self).vueI18NPhrase=a(e.chalk,e.fs,e.path,e.VueI18NExtract,e.axios,e.FormData)}(this,function(e,a,t,o,r,n){function s(e){var a=/page=([0-9]*)&per_page=100>; rel=last/.exec(e);if(!a)throw new Error("Could not get pagination info from the PhraseAPI");return parseInt(a[1])}async function i(e,a){var{data:t,headers:o}=await r.get("https://api.phraseapp.com/api/v2/projects/"+e.id+"/locales",{params:{page:a,per_page:100}});return{data:t,lastPage:s(o.link)}}async function l(e){var a=[],{data:t,lastPage:o}=await i(e,1);a.push(...t);for(var r=2;r<=o;r++){var{data:n}=await i(e,r);a.push(...n)}return a}return e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,{sync:async function(s){var{vueFiles:i,accessToken:p,projectID:c,tags:d,makeTranslation:u,skipReport:f=!1,dryRun:h=!1,outputDir:g="./phrase-reports"}=s,y=o.parseVueFiles(i),m=function(e,a){return void 0===a&&(a=!1),e.reduce((e,t)=>(e[t.path]=a?t.path:"",e),{})}(y,u);console.log(e.green("\nFound "+Object.keys(m).length+" unique keys in your Vue.js files")),function(e){r.defaults.headers.common.Authorization="token "+e,r.interceptors.response.use(e=>e,e=>{if(e.response&&429===e.response.status)throw new Error("Too many requests sent to the PhraseAPI, please wait 5 minutes and try again.");throw e})}(p),console.log(e.bold("\nGetting Phrase project and locale..."));var w=await async function(e){var{data:a}=await r.get("https://api.phraseapp.com/api/v2/projects"),t=e?a.find(a=>a.id===e):a[0];if(!t)throw new Error("Could not find project from PhraseAPI. If no project was defined as an argument, then there is no project in the selected Phrase Account");return t}(c),v=await l(w),j=await async function(e,a,t){var o;if(void 0===a&&(a=!1),t||(t=await l(e)),"string"==typeof a?(o=t.find(e=>e.code===a))||(o=t.find(e=>e.code.split("-")[0]===a)):o=t.find(e=>e.default),!o)throw new Error("Locale not found, is the argument makeTranslation set correctly?");return o}(w,u,v);console.log("Using project: "+e.green(w.name)),console.log("Using locale: "+e.green(j.code)),await async function(e){return a.mkdir(t.resolve(process.cwd(),e),{recursive:!0},e=>{if(e)throw e})}(g);var P=function(e,o,r){var n=t.resolve(process.cwd(),o,r.code+".json");return a.writeFile(n,JSON.stringify(e),e=>{if(e)throw e}),n}(m,g,j);if(console.log("\nUploading keys to Phrase for the "+e.bold(j.name)+" locale."),d&&console.log("With the tags "+e.bold(d)),u&&console.log("With the keys set as the translation"),h)console.log(e.bgRed.whiteBright("\nPsyke! it's a dry run, nothing is changed in Phrase!"));else{var k=await async function(e,t,o,s,i){void 0===i&&(i=!1);var l=new n;l.append("file",a.createReadStream(e),o.code+"-"+(s||"").split(",").join("-")+".json"),l.append("file_format","simple_json"),l.append("locale_id",o.id),s&&l.append("tags",s),l.append("update_translations",""+!!i),l.append("skip_upload_tags","true");var{data:p}=await r.post("https://api.phraseapp.com/api/v2/projects/"+t.id+"/uploads",l,{headers:l.getHeaders()});return async function(e,a){return new Promise((t,o)=>{var n=1;!function s(){n<13?setTimeout(async()=>{var{data:o}=await r.get("https://api.phraseapp.com/api/v2/projects/"+e.id+"/uploads/"+a.id);"success"===o.state?t(o):(n++,s())},500):o("It has taken over a minute to confirm the upload was a success. Please refer to your Phrase Dashboard Web UI Uploaded Files section for more information.")}()})}(t,p)}(P,w,j,d,u);console.log("\nKeys successfully added!"),console.log("\nUpload File Summary:"),console.log("File Name: "+k.filename),console.log("Keys Created: "+k.summary.translation_keys_created),console.log("Keys Updated: "+k.summary.translations_updated),console.log("Keys Unmentioned: "+k.summary.translation_keys_unmentioned),console.log("Key Translations Created: "+k.summary.translations_created),console.log("Key Translations Updated: "+k.summary.translations_updated),console.log("Tags Created: "+k.summary.tags_created)}if(!f){console.log(e.bold("\nGenerating a full report...")),d&&console.log("Getting all translations with the tags "+e.bold(d));var _=await async function(e,a,t){var o={},n=async function(e){var{data:n}=await r.get("https://api.phraseapp.com/api/v2/projects/"+a.id+"/locales/"+e.id+"/download",{params:{file_format:"simple_json",tags:t}});o[e.code]=Object.keys(n).map(a=>({language:e.code,path:a}))};for(var s of e)await n(s);return o}(v,w,d),b=o.extractI18NReport(y,_);await o.writeReportToFile(b,g+"/report.json")}console.log(e.green("\nComplete! you can view you language file and report at "+g+"\n"))}}});
//# sourceMappingURL=vue-i18n-phrase.umd.js.map
