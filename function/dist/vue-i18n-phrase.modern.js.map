{"version":3,"file":"vue-i18n-phrase.modern.js","sources":["../../src/phrase/projects.ts","../../src/phrase/locales.ts","../../src/phrase/setup.ts","../src/index.ts"],"sourcesContent":["import axios from 'axios';\nimport { PhraseProject } from '../types';\n\nexport async function getProject (projectID?: string): Promise<PhraseProject> {\n  const { data: projects }: { data: PhraseProject[] } =\n    await axios.get('https://api.phraseapp.com/api/v2/projects');\n\n  console.log(projects);\n\n\n  const project = (projectID) ? projects.find((project) => project.id === projectID) : projects[0];\n\n  if (!project) throw new Error('Could not find project from PhraseAPI. If no project was defined as an argument, then there is no project in the selected Phrase Account')\n\n  return project;\n}\n","import axios from 'axios';\nimport { PhraseProject, PhraseLocale } from '../types';\n\nfunction getLastPageFromLink (link: string): number {\n  const regex = /page=([0-9]*)&per_page=100>; rel=last/;\n  const regexMatch = regex.exec(link);\n\n  if (!regexMatch) throw new Error('Could not get pagination info from the PhraseAPI');\n\n  return parseInt(regexMatch[1]);\n}\n\nasync function getPageOfLocales (project: PhraseProject, page: number): Promise<{ data: PhraseLocale[]; lastPage: number }> {\n  const { data, headers } = await axios.get(`https://api.phraseapp.com/api/v2/projects/${project.id}/locales`, {\n    params: {\n      page,\n      per_page: 100, // eslint-disable-line @typescript-eslint/camelcase\n    },\n  });\n  return {\n    data,\n    lastPage: getLastPageFromLink(headers.link),\n  };\n}\n\nexport async function getLocales (project: PhraseProject): Promise<PhraseLocale[]> {\n  const locales: PhraseLocale[] = [];\n\n  const { data: firstData, lastPage } = await getPageOfLocales(project, 1);\n  locales.push(...firstData);\n\n  for (let page = 2; page <= lastPage; page++) {\n    const { data } = await getPageOfLocales(project, page);\n    locales.push(...data);\n  }\n\n  return locales;\n}\n\nexport async function getLocale (project: PhraseProject, localeCode: string | boolean = false, locales?: PhraseLocale[]): Promise<PhraseLocale> {\n  if (!locales) {\n    locales = await getLocales(project);\n  }\n\n  let locale: PhraseLocale | undefined;\n  if (typeof localeCode === 'string') {\n    locale = locales.find((locale) => locale.code === localeCode);\n  }\n  locale = locales.find((locale) => locale.default);\n\n  if (!locale) throw new Error('Locale not found, is the argument makeTranslation set correctly?');\n\n  return locale;\n}\n\n\n","import axios, { AxiosError } from 'axios';\n\nexport function setupAxios (accessToken: string): void {\n  axios.defaults.headers.common.Authorization = `token ${accessToken}`;\n  axios.interceptors.response.use(\n    (response) => response,\n    (error: AxiosError) => {\n      if (error.response && error.response.status === 429) {\n        throw new Error('Too many requests sent to the PhraseAPI, please wait 5 minutes and try again.');\n      }\n\n      throw error;\n    },\n  );\n}\n","import express from 'express';\nimport axios from 'axios';\nimport cors from 'cors';\nimport { getLocale, getProject } from '../../src/phrase';\nimport { setupAxios } from '../../src/phrase/setup';\nconst corsHandler = cors({ origin: '*' });\n\nconst app = express();\napp.use(corsHandler);\n\napp.get('/getLocaleFromPhrase', async (req, res) => {\n  if (process.env.PHRASE_ACCESS_TOKEN) {\n    setupAxios(process.env.PHRASE_ACCESS_TOKEN);\n  } else {\n    throw new Error('No PHRASE_ACCESS_TOKEN environment variable defined.');\n  }\n\n  const selectedProject = await getProject(process.env.PHRASE_PROJECT_ID);\n  const locale = await getLocale(selectedProject, req.query.locale);\n\n  const { data, headers } = await axios.get(`https://api.phraseapp.com/api/v2/projects/${selectedProject.id}/locales/${locale.id}/download`, {\n    params: {\n      file_format: 'simple_json', // eslint-disable-line @typescript-eslint/camelcase\n      tags: req.query.tags\n    }\n  });\n\n  res\n    .set('Content-Type', 'application/json')\n    .set('Link', headers.link)\n    .set('Cache-Control', 'public, max-age=3600, s-maxage=7200')\n    .send(JSON.stringify(data));\n});\n\napp.listen(process.env.PORT || 8080, () => console.log('Phrase Locale Server Started'));\n"],"names":["getProject","projectID","data","projects","axios","get","console","log","project","find","id","Error","getLastPageFromLink","link","regex","regexMatch","exec","parseInt","getPageOfLocales","page","headers","params","per_page","lastPage","getLocales","locales","firstData","push","getLocale","localeCode","locale","code","default","setupAxios","accessToken","defaults","common","Authorization","interceptors","response","use","error","status","corsHandler","cors","origin","app","express","req","res","process","env","PHRASE_ACCESS_TOKEN","selectedProject","PHRASE_PROJECT_ID","query","file_format","tags","set","send","JSON","stringify","listen","PORT"],"mappings":"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"}