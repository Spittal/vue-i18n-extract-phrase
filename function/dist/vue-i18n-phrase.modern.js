import e from"express";import a from"axios";import r from"cors";import"form-data";import"fs";function t(e){var a=/page=([0-9]*)&per_page=100>; rel=last/.exec(e);if(!a)throw new Error("Could not get pagination info from the PhraseAPI");return parseInt(a[1])}async function o(e,r){var{data:o,headers:s}=await a.get("https://api.phraseapp.com/api/v2/projects/"+e.id+"/locales",{params:{page:r,per_page:100}});return{data:o,lastPage:t(s.link)}}var s=r({origin:"*"}),n=e();n.use(s),n.get("/getLocaleFromPhrase",async(e,r)=>{if(!process.env.PHRASE_ACCESS_TOKEN){var t=new Error("No PHRASE_ACCESS_TOKEN environment variable defined.");throw r.status(500).send(JSON.stringify({error:t.toString()})),t}var s;s=process.env.PHRASE_ACCESS_TOKEN,a.defaults.headers.common.Authorization="token "+s,a.interceptors.response.use(e=>e,e=>{if(e.response&&429===e.response.status)throw new Error("Too many requests sent to the PhraseAPI, please wait 5 minutes and try again.");throw e});var n=await async function(e){var{data:r}=await a.get("https://api.phraseapp.com/api/v2/projects"),t=e?r.find(a=>a.id===e):r[0];if(!t)throw new Error("Could not find project from PhraseAPI. If no project was defined as an argument, then there is no project in the selected Phrase Account");return t}(process.env.PHRASE_PROJECT_ID),i=await async function(e,a,r){var t;if(void 0===a&&(a=!1),r||(r=await async function(e){var a=[],{data:r,lastPage:t}=await o(e,1);a.push(...r);for(var s=2;s<=t;s++){var{data:n}=await o(e,s);a.push(...n)}return a}(e)),"string"==typeof a?(t=r.find(e=>e.code===a))||(t=r.find(e=>e.code.split("-")[0]===a)):t=r.find(e=>e.default),!t)throw new Error("Locale not found, is the argument makeTranslation set correctly?");return t}(n,e.query.locale);try{var{data:p}=await a.get("https://api.phraseapp.com/api/v2/projects/"+n.id+"/locales/"+i.id+"/download",{params:{file_format:"simple_json",tags:e.query.tags}});r.set("Content-Type","application/json").set("Cache-Control","max-age=3600").send(JSON.stringify(p))}catch(e){throw r.status(e.response.status||500).send(JSON.stringify(e.response.data)),e}}),n.listen(process.env.PORT||8080,()=>console.log("Phrase Locale Server Started"));
//# sourceMappingURL=vue-i18n-phrase.modern.js.map
