!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("express"),require("axios"),require("cors"),require("form-data"),require("fs")):"function"==typeof define&&define.amd?define(["express","axios","cors","form-data","fs"],t):t((e=e||self).express,e.axios,e.cors,e.FormData,e.fs)}(this,function(e,t,a,r,o){function s(e){var t=/page=([0-9]*)&per_page=100>; rel=last/.exec(e);if(!t)throw new Error("Could not get pagination info from the PhraseAPI");return parseInt(t[1])}async function n(e,a){var{data:r,headers:o}=await t.get("https://api.phraseapp.com/api/v2/projects/"+e.id+"/locales",{params:{page:a,per_page:100}});return{data:r,lastPage:s(o.link)}}e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o;var i=a({origin:"*"}),p=e();p.use(i),p.get("/getLocaleFromPhrase",async(e,a)=>{if(!process.env.PHRASE_ACCESS_TOKEN){var r=new Error("No PHRASE_ACCESS_TOKEN environment variable defined.");throw a.status(500).send(JSON.stringify({error:r.toString()})),r}var o;o=process.env.PHRASE_ACCESS_TOKEN,t.defaults.headers.common.Authorization="token "+o,t.interceptors.response.use(e=>e,e=>{if(e.response&&429===e.response.status)throw new Error("Too many requests sent to the PhraseAPI, please wait 5 minutes and try again.");throw e});var s=await async function(e){var{data:a}=await t.get("https://api.phraseapp.com/api/v2/projects"),r=e?a.find(t=>t.id===e):a[0];if(!r)throw new Error("Could not find project from PhraseAPI. If no project was defined as an argument, then there is no project in the selected Phrase Account");return r}(process.env.PHRASE_PROJECT_ID),i=await async function(e,t,a){var r;if(void 0===t&&(t=!1),a||(a=await async function(e){var t=[],{data:a,lastPage:r}=await n(e,1);t.push(...a);for(var o=2;o<=r;o++){var{data:s}=await n(e,o);t.push(...s)}return t}(e)),"string"==typeof t?(r=a.find(e=>e.code===t))||(r=a.find(e=>e.code.split("-")[0]===t)):r=a.find(e=>e.default),!r)throw new Error("Locale not found, is the argument makeTranslation set correctly?");return r}(s,e.query.locale);try{var{data:p}=await t.get("https://api.phraseapp.com/api/v2/projects/"+s.id+"/locales/"+i.id+"/download",{params:{file_format:"simple_json",tags:e.query.tags}});a.set("Content-Type","application/json").set("Cache-Control","max-age=3600").send(JSON.stringify(p))}catch(e){throw a.status(e.response.status||500).send(JSON.stringify(e.response.data)),e}}),p.listen(process.env.PORT||8080,()=>console.log("Phrase Locale Server Started"))});
//# sourceMappingURL=vue-i18n-phrase.umd.js.map
