{"version":3,"file":"vue-i18n-phrase.umd.js","sources":["../../src/phrase/projects.ts","../../src/phrase/locales.ts","../../src/phrase/setup.ts","../src/index.ts"],"sourcesContent":["import axios from 'axios';\nimport { PhraseProject } from '../types';\n\nexport async function getProject (projectID?: string): Promise<PhraseProject> {\n  const { data: projects }: { data: PhraseProject[] } =\n    await axios.get('https://api.phraseapp.com/api/v2/projects');\n\n  const project = (projectID) ? projects.find((project) => project.id === projectID) : projects[0];\n\n  if (!project) throw new Error('Could not find project from PhraseAPI. If no project was defined as an argument, then there is no project in the selected Phrase Account')\n\n  return project;\n}\n","import axios from 'axios';\nimport { PhraseProject, PhraseLocale } from '../types';\n\nfunction getLastPageFromLink (link: string): number {\n  const regex = /page=([0-9]*)&per_page=100>; rel=last/;\n  const regexMatch = regex.exec(link);\n\n  if (!regexMatch) throw new Error('Could not get pagination info from the PhraseAPI');\n\n  return parseInt(regexMatch[1]);\n}\n\nasync function getPageOfLocales (project: PhraseProject, page: number): Promise<{ data: PhraseLocale[]; lastPage: number }> {\n  const { data, headers } = await axios.get(`https://api.phraseapp.com/api/v2/projects/${project.id}/locales`, {\n    params: {\n      page,\n      per_page: 100, // eslint-disable-line @typescript-eslint/camelcase\n    },\n  });\n  return {\n    data,\n    lastPage: getLastPageFromLink(headers.link),\n  };\n}\n\nexport async function getLocales (project: PhraseProject): Promise<PhraseLocale[]> {\n  const locales: PhraseLocale[] = [];\n\n  const { data: firstData, lastPage } = await getPageOfLocales(project, 1);\n  locales.push(...firstData);\n\n  for (let page = 2; page <= lastPage; page++) {\n    const { data } = await getPageOfLocales(project, page);\n    locales.push(...data);\n  }\n\n  return locales;\n}\n\nexport async function getLocale (project: PhraseProject, localeCode: string | boolean = false, locales?: PhraseLocale[]): Promise<PhraseLocale> {\n  if (!locales) {\n    locales = await getLocales(project);\n  }\n\n  let locale: PhraseLocale | undefined;\n  if (typeof localeCode === 'string') {\n    locale = locales.find((locale) => locale.code === localeCode);\n  } else {\n    locale = locales.find((locale) => locale.default);\n  }\n\n  if (!locale) throw new Error('Locale not found, is the argument makeTranslation set correctly?');\n\n  return locale;\n}\n\n\n","import axios, { AxiosError } from 'axios';\n\nexport function setupAxios (accessToken: string): void {\n  axios.defaults.headers.common.Authorization = `token ${accessToken}`;\n  axios.interceptors.response.use(\n    (response) => response,\n    (error: AxiosError) => {\n      if (error.response && error.response.status === 429) {\n        throw new Error('Too many requests sent to the PhraseAPI, please wait 5 minutes and try again.');\n      }\n\n      throw error;\n    },\n  );\n}\n","import express from 'express';\nimport axios from 'axios';\nimport cors from 'cors';\nimport { getLocale, getProject } from '../../src/phrase';\nimport { setupAxios } from '../../src/phrase/setup';\nconst corsHandler = cors({ origin: '*' });\n\nconst app = express();\napp.use(corsHandler);\n\napp.get('/getLocaleFromPhrase', async (req, res) => {\n  if (process.env.PHRASE_ACCESS_TOKEN) {\n    setupAxios(process.env.PHRASE_ACCESS_TOKEN);\n  } else {\n    const error = new Error('No PHRASE_ACCESS_TOKEN environment variable defined.');\n    res\n      .status(500)\n      .send(JSON.stringify({ error: error.toString() }));\n    throw error;\n  }\n\n  const selectedProject = await getProject(process.env.PHRASE_PROJECT_ID);\n  const locale = await getLocale(selectedProject, req.query.locale);\n\n  try {\n    const { data } = await axios.get(`https://api.phraseapp.com/api/v2/projects/${selectedProject.id}/locales/${locale.id}/download`, {\n      params: {\n        file_format: 'simple_json', // eslint-disable-line @typescript-eslint/camelcase\n        tags: req.query.tags\n      }\n    });\n\n    res\n      .set('Content-Type', 'application/json')\n      .set('Cache-Control', 'max-age=3600')\n      .send(JSON.stringify(data));\n  } catch (e) {\n    res\n      .status(e.response.status || 500)\n      .send(JSON.stringify(e.response.data));\n    throw e;\n  }\n});\n\napp.listen(process.env.PORT || 8080, () => console.log('Phrase Locale Server Started'));\n"],"names":["getProject","projectID","data","projects","axios","get","project","find","id","Error","getLastPageFromLink","link","regex","regexMatch","exec","parseInt","getPageOfLocales","page","headers","params","per_page","lastPage","getLocales","locales","firstData","push","getLocale","localeCode","locale","code","default","setupAxios","accessToken","defaults","common","Authorization","interceptors","response","use","error","status","corsHandler","cors","origin","app","express","req","res","process","env","PHRASE_ACCESS_TOKEN","send","JSON","stringify","toString","selectedProject","PHRASE_PROJECT_ID","query","file_format","tags","set","e","listen","PORT","console","log"],"mappings":"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"}